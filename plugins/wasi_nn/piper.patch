diff --git a/CMakeLists.txt b/CMakeLists.txt
index f96ec44..ca6f28c 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -3,6 +3,7 @@ cmake_minimum_required(VERSION 3.13)
 project(piper C CXX)
 
 file(READ "${CMAKE_CURRENT_LIST_DIR}/VERSION" piper_version)
+string(REPLACE "\n" "" piper_version ${piper_version})
 
 set(CMAKE_CXX_STANDARD 17)
 set(CMAKE_CXX_STANDARD_REQUIRED ON)
@@ -17,8 +18,9 @@ elseif(NOT APPLE)
   string(APPEND CMAKE_C_FLAGS " -Wall -Wextra")
 endif()
 
-add_executable(piper src/cpp/main.cpp src/cpp/piper.cpp)
+add_library(piper OBJECT src/cpp/piper.cpp src/cpp/piper.hpp)
 add_executable(test_piper src/cpp/test.cpp src/cpp/piper.cpp)
+set_target_properties(test_piper PROPERTIES EXCLUDE_FROM_ALL TRUE)
 
 # NOTE: external project prefix are shortened because of path length restrictions on Windows
 # NOTE: onnxruntime is pulled from piper-phonemize
